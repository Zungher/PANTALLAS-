<!DOCTYPE html>
<html lang="es">
<head>
 <meta charset="UTF-8">
 <meta http-equiv="refresh" content="300">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Panel Informativo Mejorado</title>

 <!-- Leaflet CSS -->
 <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

 <style>
   body {
     margin: 0;
     font-family: Arial, sans-serif;
     display: flex;
     flex-direction: column;
     height: 100vh;
     background-color: #000;
     color: #fff;
   }

   .section {
     display: flex;
     justify-content: center;
     align-items: center;
     padding: 0;
     box-sizing: border-box;
     overflow: hidden;
   }

   .vuelos { flex: 1; }
   .mapa { flex: 1; position: relative; }
   .clima { flex: 1.2; }

   iframe {
     width: 100%;
     height: 100%;
     border: none;
   }

   #map {
     width: 100%;
     height: 100%;
   }

   .weather-container {
     position: relative;
     width: 100%;
     height: 100%;
     display: flex;
     flex-direction: column;
     justify-content: center;
     align-items: center;
     padding: 20px;
     background-color: #111;
     background-size: cover;
     background-position: center;
     background-repeat: no-repeat;
     transition: background-image 0.5s ease-in-out;
     color: #fff;
   }

   .weather-container::before {
     content: "";
     position: absolute;
     top: 0; left: 0;
     width: 100%; height: 100%;
     background: linear-gradient(to bottom, rgba(0,0,0,0.5), rgba(0,0,0,0.2));
     z-index: 1;
   }

   .weather-main, .forecast {
     position: relative;
     z-index: 2;
     width: 100%;
   }

   .temp {
     text-align: center;
     font-size: 6vw;
     margin-bottom: 20px;
     font-weight: 300;
   }

   .condition {
     display: flex;
     align-items: center;
     justify-content: center;
     gap: 15px;
     font-size: 2.5vw;
     font-weight: 500;
     margin-bottom: 20px;
   }

   .weather-icon-img {
     width: 60px;
     height: 60px;
   }

   .details {
     display: flex;
     justify-content: center;
     gap: 3vw;
     margin-top: 20px;
     font-size: 1.5vw;
     flex-wrap: wrap;
   }

   .detail-item {
     display: flex;
     align-items: center;
     gap: 10px;
   }

   .detail-icon {
     width: 32px;
     height: 32px;
     object-fit: contain;
   }

   .forecast {
     background-color: rgba(0,0,0,0.3);
     backdrop-filter: blur(5px);
     padding: 10px;
     border-radius: 8px;
     display: flex;
     justify-content: space-around;
     flex-wrap: wrap;
     margin-top: 20px;
   }

   .forecast-hour {
     text-align: center;
     flex: 1;
     min-width: 80px;
     font-size: 1.2vw;
     color: #fff;
     margin: 5px;
   }

   .forecast-hour img {
     width: 48px;
     height: 48px;
     margin: 8px 0;
   }
 </style>
</head>

<body>

 <!-- Sección 1: Vuelos -->
 <div class="section vuelos">
   <iframe src="https://vuelosrepo-git-main-zunghers-projects.vercel.app/"></iframe>
 </div>

 <!-- Sección 2: Mapa Dinámico -->
 <div class="section mapa">
   <div id="map"></div>
 </div>

 <!-- Sección 3: Clima Dinámico Mejorado -->
 <div class="section clima">
   <div class="weather-container" id="weather-container">

     <div class="weather-main">

       <div class="temp" id="current-temp">--°C</div>

       <div class="condition">
         <img id="weather-icon-img" src="" alt="icono clima" class="weather-icon-img">
         <div id="description">Cargando...</div>
       </div>

       <div class="details">
         <div class="detail-item">
           <img src="https://cdn-icons-png.flaticon.com/512/481/481069.png" alt="Viento" class="detail-icon">
           <span id="wind">-- km/h</span>
         </div>
         <div class="detail-item">
           <img src="https://cdn-icons-png.flaticon.com/512/728/728093.png" alt="Humedad" class="detail-icon">
           <span id="humidity">--%</span>
         </div>
         <div class="detail-item">
           <img src="https://cdn-icons-png.flaticon.com/512/4148/4148460.png" alt="Presión" class="detail-icon">
           <span id="pressure">-- hPa</span>
         </div>
       </div>

     </div>

     <div class="forecast" id="forecast-container">
       <div class="forecast-hour">
         <div>08:00</div>
         <img src="https://cdn-icons-png.flaticon.com/512/1163/1163661.png" alt="forecast">
         <div>6°C</div>
       </div>
       <div class="forecast-hour">
         <div>09:00</div>
         <img src="https://cdn-icons-png.flaticon.com/512/1163/1163624.png" alt="forecast">
         <div>5°C</div>
       </div>
       <div class="forecast-hour">
         <div>10:00</div>
         <img src="https://cdn-icons-png.flaticon.com/512/1163/1163661.png" alt="forecast">
         <div>5°C</div>
       </div>
       <div class="forecast-hour">
         <div>11:00</div>
         <img src="https://cdn-icons-png.flaticon.com/512/1163/1163661.png" alt="forecast">
         <div>6°C</div>
       </div>
       <div class="forecast-hour">
         <div>12:00</div>
         <img src="https://cdn-icons-png.flaticon.com/512/1163/1163624.png" alt="forecast">
         <div>7°C</div>
       </div>
     </div>

   </div>
 </div>

 <!-- Leaflet JS -->
 <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

 <script>
   // ===================== MAPA DINÁMICO =======================
   const hotelLatLng = [14.6094, -90.5186];
   const aeropuertoLatLng = [14.5833, -90.5270];

   const map = L.map('map').setView([14.596, -90.523], 14);

   L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
     attribution: '&copy; OpenStreetMap contributors'
   }).addTo(map);

   L.marker(hotelLatLng).addTo(map)
     .bindPopup('<b>Hotel Barceló Guatemala City</b>').openPopup();

   L.marker(aeropuertoLatLng).addTo(map)
     .bindPopup('<b>Aeropuerto La Aurora</b>');

   const ruta = L.polyline([hotelLatLng, aeropuertoLatLng], {
     color: 'red',
     weight: 5
   }).addTo(map);

   map.fitBounds(ruta.getBounds());

   // ===================== CLIMA DINÁMICO =======================
   async function cargarClima() {
     try {
       const res = await fetch('https://clima-git-main-zunghers-projects.vercel.app/');
       const data = await res.json();

       document.getElementById('current-temp').innerText = data.temperatura || '--°C';
       document.getElementById('description').innerText = data.estado || 'Sin datos';
       document.getElementById('wind').innerText = `${data.viento || '--'} km/h`;
       document.getElementById('humidity').innerText = `${data.humedad || '80'}%`;
       document.getElementById('pressure').innerText = `${data.presion || '1012'} hPa`;

       const estado = (data.estado || '').toLowerCase();
       let iconoURL = 'https://cdn-icons-png.flaticon.com/512/414/414825.png'; // Nublado por defecto
       let bgImage = 'url("https://source.unsplash.com/1600x900/?cloudy")';

       if (estado.includes('despejado')) {
         iconoURL = 'https://cdn-icons-png.flaticon.com/512/869/869869.png'; // Sol
         bgImage = 'url("https://media.istockphoto.com/id/824800468/es/foto/sol-en-el-cielo-azul-con-nubes.jpg")';
       } else if (estado.includes('nublado')) {
         iconoURL = 'https://cdn-icons-png.flaticon.com/512/414/414825.png'; // Nublado
         bgImage = 'url("https://media.istockphoto.com/id/1156241578/es/foto/cielo-oscuro-con-nubes-de-tormenta.jpg")';
       } else if (estado.includes('lluvia')) {
         iconoURL = 'https://cdn-icons-png.flaticon.com/512/1163/1163624.png'; // Lluvia
         bgImage = 'url("https://media.istockphoto.com/id/1429701799/es/foto/gotas-de-lluvia-sobre-asfalto.jpg")';
       } else if (estado.includes('chubasco')) {
         iconoURL = 'https://cdn-icons-png.flaticon.com/512/1208/1208750.png'; // Chubasco
         bgImage = 'url("https://cdn0.ecologiaverde.com/es/posts/1/7/6/que_son_los_chubascos_4671_0_600.jpg")';
       } else if (estado.includes('niebla')) {
         iconoURL = 'https://cdn-icons-png.flaticon.com/512/1779/1779807.png'; // Niebla
         bgImage = 'url("https://fotografias.larazon.es/clipping/cmsimages01/2023/12/02/C23C7773-C437-4B86-93D6-7A41E43D3BF2/que-niebla-cuales-son-sus-tipos_98.jpg?crop=1120,630,x41,y0&width=1900&height=1069&optimize=low&format=webply")';
       }

       document.getElementById('weather-icon-img').src = iconoURL;
       document.getElementById('weather-container').style.backgroundImage = bgImage;

     } catch (error) {
       console.error('Error al cargar el clima', error);
     }
   }

   cargarClima();
 </script>

</body>
</html>
